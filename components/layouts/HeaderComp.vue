<script setup lang="ts">
import { useRoute, useLocalePath, useUserSession } from '#imports'
import { useFetchWithState } from '~/composables/useFetchWithState'
import type Notification from '~/utils/interface/Notification'
import { isNotNull } from '~/utils/types/typeGuards'
import { ref, onMounted, onBeforeUnmount, watch } from 'vue'

const route = useRoute()
const localePath = useLocalePath()
const { loggedIn, user } = useUserSession()

const showNotifModal = ref(false)

const {
  data: notifications,
  isSuccess: isFetchNotificationsSuccess,
  isLoading: isFetchGetNotificationsLoading,
  error: fetchNotificationsError,
  execute: executeFetchNotifications
} = useFetchWithState<Notification[]>('/api/notifications')

// IMPROVE : use a better way to refresh notifications
let notificationInterval: ReturnType<typeof setInterval> | null = null

const refreshNotifications = () => {
  if (loggedIn) {
    executeFetchNotifications()
  }
}

watch(loggedIn, () => {
  refreshNotifications()
})

onMounted(() => {
  refreshNotifications()
  notificationInterval = setInterval(refreshNotifications, 300000) // 5 minutes
})

onBeforeUnmount(() => {
  if (isNotNull(notificationInterval)) {
    clearInterval(notificationInterval)
    notificationInterval = null
  }
})
</script>

<template>
  <header
    class="flex items-center justify-between px-10 md:px-20 h-20 fixed top-0 left-0 w-screen z-50 bg-background bg-opacity-80"
  >
    <NuxtLink :to="localePath('/')" data-cy="header-logo">
      <div>
        <svg class="fill-on-background hover:fill-primary" width="125" height="50">
          <path
            style="stroke-width: 0.264583"
            d="m 29.339268,53.225114 c -0.232886,-0.23288 -0.309219,-2.22481 -0.286422,-7.47448 0.03786,-8.71936 0.240768,-12.3654 0.696526,-12.51585 0.247256,-0.0816 0.330729,0.46006 0.330729,2.14621 0,1.24047 0.119063,2.32898 0.264584,2.41891 0.166282,0.10277 0.264583,2.93963 0.264583,7.63562 0,7.20436 -0.08838,8.10709 -0.79375,8.10709 -0.08731,0 -0.301625,-0.14287 -0.47625,-0.3175 z m 7.154561,-3.64982 c -2.442954,-1.48948 -2.560714,-4.69801 -0.237469,-6.47004 0.808908,-0.61699 1.107091,-0.67514 3.461909,-0.67514 1.943346,0 2.549879,0.0813 2.467404,0.33073 -0.07129,0.21561 -0.792719,0.35643 -2.072569,0.40455 -2.386195,0.0897 -3.569578,0.59641 -4.128029,1.7675 -0.689626,1.44616 -0.03372,3.34892 1.371068,3.97741 0.291042,0.13021 1.472285,0.30301 2.624987,0.38401 1.329637,0.0934 2.135682,0.26817 2.20486,0.47799 0.08203,0.24879 -0.502743,0.33048 -2.360403,0.32974 -1.997237,-7.9e-4 -2.634335,-0.10152 -3.331758,-0.52675 z m 10.061794,0.13547 c -1.846434,-0.80269 -2.600023,-3.99982 -1.354939,-5.74838 1.469443,-2.06365 5.038159,-1.97002 6.340915,0.16635 0.687265,1.12704 0.674285,3.39737 -0.02503,4.37948 -1.032253,1.44967 -3.189573,1.97261 -4.960938,1.20255 z m 3.077494,-0.78483 c 1.502171,-0.7768 2.032116,-2.53787 1.230299,-4.08842 -1.155602,-2.23468 -4.112877,-2.06724 -5.338191,0.30225 -0.569127,1.10057 -0.134313,2.57204 1.031557,3.49094 0.964301,0.76002 1.987616,0.85823 3.076335,0.29523 z m 4.904345,0.83238 c -0.07276,-0.1896 -0.09878,-1.88624 -0.05784,-3.77032 0.07049,-3.24388 0.103735,-3.42977 0.626711,-3.50449 0.394168,-0.0563 0.911296,0.34133 1.806395,1.38906 0.689769,0.80738 1.359839,1.46797 1.489046,1.46797 0.129204,0 0.641731,-0.35719 1.138949,-0.79375 1.049091,-0.92112 1.231048,-0.96816 1.231048,-0.31828 0,0.48319 -1.804331,2.43495 -2.251025,2.43495 -0.134387,0 -0.813977,-0.56107 -1.510199,-1.24683 l -1.265859,-1.24682 v 2.5481 c 0,1.40146 -0.07227,2.73643 -0.1606,2.96661 -0.194029,0.50564 -0.862817,0.55279 -1.046623,0.0738 z m 7.14375,0 c -0.07276,-0.1896 -0.09878,-1.8765 -0.05784,-3.74867 0.05321,-2.4332 0.168759,-3.43528 0.40517,-3.51379 0.254484,-0.0845 0.330729,0.77968 0.330729,3.74867 0,2.47423 -0.0979,3.85851 -0.272886,3.85851 -0.15009,0 -0.332415,-0.15513 -0.40517,-0.34472 z m 3.244842,0.17748 c -0.102044,-0.10205 -0.185536,-0.9311 -0.185536,-1.84233 0,-2.36979 0.17694,-2.48835 3.713752,-2.48835 2.64259,0 2.90654,-0.0455 3.17491,-0.54691 0.22727,-0.42466 0.19964,-0.68892 -0.12359,-1.18223 -0.39411,-0.60149 -0.57832,-0.63929 -3.45937,-0.70986 -1.802586,-0.0442 -3.043127,-0.1824 -3.043172,-0.33912 -8.2e-5,-0.28804 5.552452,-0.51825 6.545672,-0.27139 0.81027,0.20138 1.47347,1.55565 1.25312,2.5589 -0.29187,1.32886 -1.43068,1.81138 -4.27781,1.81254 l -2.434187,10e-4 -0.07935,1.51878 c -0.05842,1.11822 -0.187423,1.53932 -0.489125,1.59665 -0.225377,0.0428 -0.493268,-0.006 -0.595313,-0.10767 z m 8.671516,-0.10784 c -0.0935,-0.15129 0.62832,-1.8777 1.60405,-3.83646 1.26901,-2.54751 1.90639,-3.56138 2.2389,-3.56138 0.3325,0 0.96988,1.01387 2.23889,3.56138 1.6249,3.26194 1.87024,4.11154 1.18729,4.11154 -0.13572,0 -0.9036,-1.30969 -1.70639,-2.91042 -0.8028,-1.60073 -1.57671,-2.91041 -1.71979,-2.91041 -0.14309,0 -0.917,1.30968 -1.7198,2.91041 -1.40366,2.79882 -1.75364,3.23323 -2.12315,2.63534 z m 11.14678,-0.23336 c -2.38215,-1.57043 -2.42644,-5.20392 -0.0811,-6.65284 0.85826,-0.53022 2.43455,-0.60453 2.43455,-0.11476 0,0.14552 -0.26824,0.30267 -0.59609,0.34923 -0.79074,0.11229 -2.367,1.62264 -2.58026,2.47238 -0.42608,1.69761 1.76484,3.9727 3.42456,3.55614 0.885412,-0.22222 2.354472,-1.61084 2.200012,-2.07955 -0.0631,-0.19133 -0.6822,-0.36298 -1.476832,-0.40942 -0.92785,-0.0542 -1.36827,-0.19416 -1.36827,-0.43472 0,-0.4729 0.59606,-0.67594 1.984382,-0.67594 1.62725,0 1.98437,0.19793 1.98437,1.09978 0,1.10428 -0.67898,2.27757 -1.66649,2.87968 -1.125502,0.68626 -3.225572,0.6912 -4.258842,0.01 z m 8.430722,0.18572 c -0.0774,-0.2017 -0.10723,-1.90824 -0.0663,-3.79232 0.0705,-3.24412 0.10296,-3.42559 0.61272,-3.42559 0.56187,0 5.67943,5.09532 5.67943,5.65475 0,0.6951 -0.80003,0.17148 -2.77812,-1.81829 -1.15734,-1.16416 -2.19232,-2.11666 -2.29995,-2.11666 -0.10763,0 -0.22948,1.27023 -0.27079,2.82274 -0.0523,1.96673 -0.17535,2.85601 -0.40568,2.93242 -0.18183,0.0603 -0.39392,-0.0554 -0.47132,-0.25705 z m 7.135308,-0.022 c -0.0728,-0.1896 -0.0988,-1.8765 -0.0579,-3.74867 0.0532,-2.4332 0.16876,-3.43528 0.40517,-3.51379 0.25449,-0.0845 0.33073,0.77968 0.33073,3.74867 0,2.47423 -0.0979,3.85851 -0.27288,3.85851 -0.15009,0 -0.33242,-0.15513 -0.40517,-0.34472 z m 5.57285,0.0908 c -0.79582,-0.33134 -1.87404,-1.61584 -2.21681,-2.64092 -0.74262,-2.22083 1.32349,-4.77963 3.85731,-4.77714 2.91402,0.003 4.78764,3.44467 3.18287,5.84687 -1.01365,1.51733 -3.22367,2.23724 -4.82337,1.57119 z m 3.3793,-1.35289 c 0.91467,-0.75395 0.98632,-0.91591 0.98632,-2.22969 0,-1.31377 -0.0717,-1.47574 -0.98632,-2.2297 -0.58539,-0.48252 -1.28982,-0.81301 -1.73293,-0.81301 -2.21273,0 -3.7958,2.44179 -2.79521,4.31142 1.02036,1.90657 2.89764,2.30498 4.52814,0.96099 z m 4.60229,1.43037 c -0.097,-0.097 -0.17639,-1.76762 -0.17639,-3.71246 0,-2.98746 0.0652,-3.56112 0.42052,-3.69745 0.29195,-0.11203 1.18722,0.59829 2.92837,2.32341 2.83839,2.81227 3.22556,3.34129 2.61643,3.57504 -0.27652,0.10611 -1.11335,-0.57865 -2.60342,-2.13032 -1.20775,-1.25768 -2.27967,-2.20294 -2.38203,-2.10058 -0.10237,0.10237 -0.18612,1.47596 -0.18612,3.05244 0,2.62398 -0.12755,3.17974 -0.61736,2.68993 z m 7.00972,-0.15167 c -0.36485,-0.36485 -0.42381,-6.48609 -0.0679,-7.04803 0.58213,-0.91905 0.81928,0.10556 0.81928,3.53964 0,3.47572 -0.1383,4.12149 -0.75139,3.5084 z M 18.782492,46.861884 c -0.298063,-0.32742 -0.837849,-1.13109 -1.199525,-1.78593 -0.361675,-0.65485 -1.04816,-1.84547 -1.525523,-2.64584 -0.83936,-1.4073 -1.311095,-2.2207 -2.34005,-4.03489 -0.268239,-0.47295 -1.344151,-2.34027 -2.390915,-4.14962 -1.046765,-1.80935 -1.8430649,-3.44646 -1.7695549,-3.63803 0.284571,-0.74158 1.8561149,-0.19357 2.2720549,0.79228 0.134409,0.31857 2.007862,3.61532 4.163228,7.3261 l 3.918847,6.74687 3.960045,0.13229 c 2.178024,0.0728 4.108872,0.22862 4.290773,0.34635 0.181901,0.11773 0.330729,0.50468 0.330729,0.85989 v 0.64585 h -4.584087 c -4.416907,0 -4.603852,-0.0217 -5.126022,-0.59532 z m 3.455033,-5.81243 c -0.61809,-0.68812 -5.915757,-9.92029 -5.915757,-10.30931 0,-0.14029 0.202432,-0.21609 0.449849,-0.16845 0.264766,0.051 1.594441,2.07018 3.231805,4.90769 1.530075,2.65157 2.964752,4.90744 3.188171,5.01302 0.223419,0.10559 1.477779,0.25735 2.787467,0.33724 1.31427,0.0802 2.38125,0.26382 2.38125,0.40985 0,0.15495 -1.156174,0.29547 -2.790256,0.33913 -2.618504,0.07 -2.823635,0.0374 -3.332529,-0.52917 z m 12.505672,-1.74112 c -0.220604,-0.35695 3.56802,-7.72613 3.97214,-7.72613 0.499996,0 4.164959,7.41397 3.830362,7.74857 -0.426072,0.42607 -0.745456,0.002 -2.146848,-2.85378 -0.747556,-1.52313 -1.468969,-2.83716 -1.603142,-2.92009 -0.134173,-0.0829 -0.920763,1.22479 -1.74798,2.90602 -1.360895,2.76587 -1.923995,3.46113 -2.304532,2.84541 z m 10.542538,-0.11071 c -0.07726,-0.20134 -0.10709,-1.96742 -0.06628,-3.9246 0.06158,-2.95378 0.14164,-3.55853 0.471067,-3.55853 0.334425,0 0.396875,0.60021 0.396875,3.81441 0,2.81548 -0.08657,3.84326 -0.330589,3.9246 -0.181824,0.0606 -0.393806,-0.0545 -0.471069,-0.25588 z m 8.993796,-1.02073 c -1.693418,-1.7319 -2.054329,-1.92347 -3.938024,-2.0903 -0.910469,-0.0806 -1.612366,-0.2773 -1.675694,-0.4695 -0.08212,-0.24921 0.518113,-0.33073 2.435114,-0.33073 3.658306,0 5.0155,-0.69709 4.120989,-2.11666 -0.190715,-0.30266 -0.990579,-0.42828 -3.369387,-0.52917 -2.537529,-0.10762 -3.119303,-0.20631 -3.119303,-0.52917 0,-0.32612 0.556311,-0.41018 3.120708,-0.47152 l 3.120707,-0.0746 0.781897,0.78189 c 1.311481,1.31149 0.830056,3.03195 -1.004041,3.58815 -0.865269,0.2624 -0.740828,0.68563 0.58384,1.9857 1.120627,1.09981 1.302018,1.59876 0.581224,1.59876 -0.178784,0 -0.915898,-0.60427 -1.63803,-1.34281 z m 5.273304,0.92429 c 0.08833,-0.23018 0.1606,-0.46831 0.1606,-0.52917 0,-0.0608 1.13892,-0.11065 2.530935,-0.11065 2.827057,0 3.554481,-0.24366 3.554481,-1.19062 0,-0.72063 -0.672025,-1.19063 -1.702398,-1.19063 -0.427034,0 -0.678852,-0.14722 -0.678852,-0.39687 0,-0.49686 2.048532,-0.54151 2.649062,-0.0577 1.122918,0.9046 1.08486,2.51195 -0.0811,3.42528 -0.836515,0.65527 -6.682409,0.70106 -6.432725,0.0504 z m 11.911085,-0.0818 c -1.45569,-0.88767 -1.9609,-1.78192 -1.9609,-3.47086 0,-1.34726 0.097,-1.62282 0.85989,-2.44285 1.73868,-1.86887 4.21566,-1.85172 5.77495,0.04 0.65455,0.79408 0.77349,1.17009 0.77349,2.44529 0,1.23964 -0.12291,1.65299 -0.69298,2.33047 -1.35536,1.61076 -3.21085,2.03926 -4.75445,1.09798 z m 3.6613,-1.28562 c 1.06226,-1.11348 1.30808,-1.99585 0.85689,-3.0757 -0.90785,-2.17278 -3.19634,-2.70737 -4.78576,-1.11795 -0.75787,0.75788 -0.89958,1.08811 -0.89958,2.09632 0,0.98357 0.14501,1.34173 0.8141,2.01083 0.67988,0.67989 1.02069,0.8141 2.06716,0.8141 1.02232,0 1.38089,-0.13398 1.94719,-0.7276 z m 4.43196,-0.31133 v -2.13607 h 2.93247 c 2.22779,0 2.90624,0.0795 2.82332,0.33073 -0.0709,0.21486 -0.88974,0.37708 -2.33715,0.46302 l -2.22801,0.13229 -0.13229,1.58518 c -0.10311,1.23552 -0.23443,1.60456 -0.59532,1.67305 -0.40999,0.0778 -0.46302,-0.15676 -0.46302,-2.0482 z m 13.870912,1.74442 c -0.27757,-0.72334 0.0128,-4.76165 0.35045,-4.87343 0.24996,-0.0828 0.33073,0.54208 0.33073,2.5584 0,1.65632 -0.10347,2.66788 -0.27289,2.66788 -0.15009,0 -0.33382,-0.15879 -0.40829,-0.35285 z m -33.180765,-3.27629 c -0.701606,-0.2864 -1.092584,-0.8457 -1.244174,-1.77984 -0.125582,-0.77389 -0.02331,-1.04188 0.657302,-1.7225 0.799806,-0.79981 0.828294,-0.80602 3.692696,-0.80602 1.58767,0 2.965014,0.0783 3.060767,0.17409 0.09575,0.0958 0.04148,0.33388 -0.120592,0.52917 -0.209862,0.25286 -1.041501,0.35507 -2.889224,0.35507 -2.749327,0 -3.426084,0.26371 -3.426084,1.33502 0,0.51806 1.2055,1.31081 1.993284,1.31081 0.237635,0 0.383206,0.14883 0.323492,0.33073 -0.117784,0.3588 -1.414232,0.53196 -2.047467,0.27347 z m 19.309853,-3.77193 c 0,-0.51431 0.15899,-0.53643 3.85586,-0.53643 3.52971,0 3.84834,0.0392 3.76701,0.46302 -0.0789,0.41092 -0.51272,0.47128 -3.85586,0.53643 -3.63176,0.0708 -3.76701,0.0541 -3.76701,-0.46302 z m 10.318752,0 c 0,-0.51431 0.15899,-0.53643 3.85586,-0.53643 3.52971,0 3.84834,0.0392 3.76701,0.46302 -0.0789,0.41092 -0.51272,0.47128 -3.85586,0.53643 -3.63176,0.0708 -3.76701,0.0541 -3.76701,-0.46302 z M 7.0613511,29.730114 c -2.907667,-0.12642 -3.04646,-0.15871 -3.127256,-0.7276 l -0.08455,-0.59531 8.4189229,0.0296 c 9.535106,0.0335 13.356465,0.22287 13.503584,0.66903 0.146422,0.44406 -12.868412,0.87829 -18.7107029,0.62427 z m 22.3138549,-0.41466 c -0.220519,-0.57466 0.339313,-1.11509 0.740027,-0.71437 0.338677,0.33868 0.128865,1.12903 -0.299715,1.12903 -0.154654,0 -0.352795,-0.18659 -0.440312,-0.41466 z m 6.591874,0.21782 c -2.155436,-0.088 -2.746774,-0.35732 -1.587499,-0.72295 0.327421,-0.10327 5.190624,-0.25086 10.807117,-0.32799 9.474439,-0.13011 10.224368,-0.1075 10.385756,0.31307 0.09567,0.24931 0.107003,0.56162 0.02519,0.69401 -0.137752,0.22288 -14.46277,0.25489 -19.630556,0.0439 z M 9.6033831,27.394964 c -0.07427,-0.12017 1.5413519,-3.12649 3.5902639,-6.68073 2.048913,-3.55423 4.02266,-6.99802 4.386104,-7.65287 1.368434,-2.4656 1.143611,-2.38125 6.346337,-2.38125 h 4.601661 l -0.08372,0.72761 -0.08372,0.7276 -4.101042,0.15679 c -2.255573,0.0862 -4.125104,0.17553 -4.154513,0.19844 -0.09352,0.0728 -2.198406,3.66737 -3.54916,6.06092 -0.307957,0.5457 -1.159331,2.00422 -1.891942,3.24114 -0.73261,1.23693 -1.688416,2.90381 -2.124012,3.70417 -0.435597,0.80036 -0.908489,1.60404 -1.050872,1.78594 -0.28909,0.36932 -1.6754889,0.45186 -1.8853849,0.11224 z m 6.7183849,-0.006 c 0,-0.14471 0.610596,-1.3143 1.35688,-2.59909 0.746284,-1.28478 1.563089,-2.69316 1.815122,-3.12972 0.252033,-0.43656 0.832062,-1.42407 1.288953,-2.19445 0.456891,-0.77039 0.830712,-1.50589 0.830712,-1.63445 0,-0.12855 0.313712,-0.4805 0.697139,-0.7821 0.59763,-0.4701 1.067485,-0.54837 3.291677,-0.54837 1.426995,0 2.664431,0.11309 2.749854,0.25131 0.298175,0.48245 -0.898745,0.80702 -2.976102,0.80702 -1.730043,0 -2.173017,0.0884 -2.554106,0.50946 -0.253578,0.2802 -1.614451,2.51156 -3.024162,4.95858 -1.525193,2.64748 -2.747938,4.48472 -3.019539,4.53703 -0.251035,0.0483 -0.456428,-0.0305 -0.456428,-0.17522 z m 24.299698,-2.72646 c -0.922803,-1.62293 -2.007957,-3.49816 -2.411452,-4.16719 -0.403497,-0.66902 -0.808548,-1.395 -0.900112,-1.61328 -0.478846,-1.14152 -0.910535,-1.32292 -3.148127,-1.32292 -2.413182,0 -3.02334,-0.13921 -3.02334,-0.68977 0,-0.49777 5.238866,-0.5314 5.8943,-0.0378 0.241554,0.1819 1.470673,2.11666 2.731378,4.29948 3.450363,5.97403 3.537241,6.13742 3.358423,6.31624 -0.468249,0.46825 -0.96746,-0.0876 -2.50107,-2.78473 z m 7.168161,2.22317 c -0.204356,-0.40018 -0.691129,-1.26338 -1.081712,-1.91823 -1.719408,-2.88272 -6.309879,-10.93501 -6.317866,-11.08238 -0.0048,-0.0893 -0.256112,-0.46006 -0.55838,-0.82387 -0.536038,-0.64516 -0.649581,-0.66354 -4.60943,-0.74605 -3.731591,-0.0778 -4.072904,-0.1257 -4.2212,-0.59295 -0.08874,-0.27959 -0.0871,-0.62847 0.0036,-0.7753 0.100393,-0.16244 1.908892,-0.26695 4.619516,-0.26695 5.313313,0 4.715981,-0.36457 7.620807,4.65131 2.810989,4.85384 2.91627,5.03606 3.503848,6.06432 1.309844,2.29222 1.562045,2.72755 2.344288,4.04654 1.075957,1.81423 1.067636,2.17117 -0.05062,2.17117 -0.694989,0 -0.959893,-0.15384 -1.252892,-0.72761 z m -18.372394,-2.11818 c -0.104032,-0.25383 -0.252355,-4.71533 -0.329608,-9.91445 -0.149217,-10.0422398 -0.09467,-10.5757498 1.02026,-9.9790598 0.474369,0.25387 0.501383,0.68038 0.501383,7.9163198 0,4.81326 -0.09807,7.70861 -0.264583,7.81152 -0.145521,0.0899 -0.264584,1.10197 -0.264584,2.24896 0,2.03304 -0.281535,2.84711 -0.662868,1.91671 z"
          />
        </svg>
      </div>
    </NuxtLink>

    <nav class="flex gap-5 md:gap-10">
      <NuxtLink
        v-if="!loggedIn"
        class="underline hover:text-primary"
        :class="{
          'cursor-default text-primary hover:text-on-background':
            route.path === localePath('/login')
        }"
        :to="localePath('/login')"
        data-cy="header-login-link"
      >
        {{ $t('components.header.login') }}
      </NuxtLink>
      <template v-else>
        <NuxtLink
          class="hover:text-primary"
          :class="{
            'cursor-default text-primary hover:text-on-background': route.path === localePath('/me')
          }"
          :to="localePath('/me')"
          data-cy="header-me-link"
        >
          <font-awesome class="text-xl mr-1" :icon="['fas', 'person-rifle']" />
          <span data-cy="header-user-pseudo">{{ user?.pseudo }}</span>
        </NuxtLink>
        <button
          class="hover:text-primary"
          @click="showNotifModal = true"
          data-cy="header-notification-button"
        >
          <font-awesome class="text-xl mr-1" :icon="['fas', 'bell']" />
          <span
            v-if="isFetchNotificationsSuccess && isNotNull(notifications)"
            data-cy="header-notification-count"
          >
            {{ notifications?.length }}
          </span>
          <font-awesome
            v-if="isFetchGetNotificationsLoading"
            class="animate-spin"
            :icon="['fas', 'spinner']"
          />
        </button>
      </template>
    </nav>

    <div
      v-if="showNotifModal"
      class="modal flex flex-col items-center justify-center"
      data-cy="header-notification-modal"
    >
      <font-awesome :icon="['fas', 'circle-xmark']" @click="showNotifModal = false" />
      <h3 class="large-title">{{ $t('components.header.notification.title') }}</h3>
      <FetchDataComp
        :error="fetchNotificationsError"
        :is-loading="isFetchGetNotificationsLoading"
      />
      <div v-if="isFetchNotificationsSuccess && isNotNull(notifications)">
        <div
          v-for="(notification, index) in notifications"
          :key="index"
          class="border-b-2 border-on-background py-5"
        >
          <p :data-cy="`header-notification-modal-message-${index + 1}`">
            {{
              notification.message.values
                ? $t(notification.message.key, notification.message.values)
                : $t(notification.message.key)
            }}
          </p>
          <NuxtLink
            v-if="notification.link"
            :to="localePath(notification.link.url)"
            class="text-secondary hover:text-primary"
            @click="showNotifModal = false"
            :data-cy="`header-notification-modal-link-${index + 1}`"
          >
            <font-awesome :icon="['fas', 'right-to-bracket']" />
            {{ $t(notification.link.linkTextKey) }}
          </NuxtLink>
        </div>
        <div v-if="notifications.length === 0" data-cy="header-notification-modal-empty">
          <p>{{ $t('components.header.notification.empty') }}</p>
        </div>
      </div>
    </div>
  </header>
</template>
